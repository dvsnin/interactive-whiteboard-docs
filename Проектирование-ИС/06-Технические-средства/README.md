# Комплекс технических средств (минимум для 1000 активных пользователей)

## Обзор
Система развёрнута в облаке и использует управляемые сервисы, что снижает нагрузку на администрирование.  
Цель — обеспечить работу до **1000 активных пользователей** с возможностью плавного масштабирования.

## Вычислительные ресурсы
- **Kubernetes-кластер**:
    - 1× control-plane (managed).
    - 2–3× worker-ноды (4 vCPU, 16 GB RAM, SSD ≥ 100 GB).
- **Автомасштабирование**: HPA по CPU/RAM для CollabService (WebSocket).
- **Сетевой слой**: Ingress для доступа извне.

## Хранилища и очереди
- **PostgreSQL**: managed-инстанс, 2 vCPU, 8 GB RAM, SSD 100 GB.
- **Redis**: single-node, 2 vCPU, 4 GB RAM (sessions, presence).
- **Kafka**: 1 брокер (2 vCPU, 4 GB RAM, 100 GB SSD) для событий и аналитики.

## Объектное хранилище и CDN
- **S3-совместимое хранилище**:
    - 1 бакет для снимков досок (JSON).
    - 1 бакет для медиафайлов.
    - Версионирование включено.
- **CDN**: для раздачи статических файлов и медиа по presigned URL.

## Наблюдаемость и эксплуатация
- **Метрики**: Prometheus + Grafana (ресурсы, задержки API).
- **Логи**: централизованный сбор (Loki или ELK light).
- **Ошибки фронтенда**: Sentry.

## CI/CD
- **CI**: GitLab Actions — тесты (Go, TS), линтеры, сборка Docker-образов.
- **CD**: деплой через Helm в Kubernetes.

## Резервное копирование
- **PostgreSQL**: ежедневные снапшоты.
- **S3**: lifecycle + контроль целостности.

## Безопасность
- **Аутентификация**: Keycloak (OIDC/JWT).
- **Webhooks**: подпись запросов (например, Tpay).
- **Шифрование**: TLS 1.2+, шифрование данных в S3/PostgreSQL (managed).

## Производительность (на старте)
- **CollabService (WS)**: ~2000 постоянных соединений на pod.
- **API**: P95 < 150 ms при 300–500 rps.
- **Снапшоты досок**: 50–200 KB, хранение в S3.

Систему спроектирована так, чтобы выдержать до 1000 активных пользователей при минимальных затратах.  
Архитектура основана на Kubernetes с 2–3 рабочими нодами и управляемыми сервисами (PostgreSQL, Redis, S3).  
Все данные досок и медиаконтент хранятся в S3, что упрощает масштабирование и резервное копирование.  
Совместная работа в реальном времени обеспечивается через CollabService и WebSocket, Kafka используется для событий и аналитики.  
Мониторинг и логи покрывают базовые метрики и ошибки, а резервное копирование даёт RPO (максимально допустимая потеря данных) ≤ 15 минут.  
Такой набор минимален, но при этом надёжно покрывает все ключевые сценарии работы системы и может масштабироваться горизонтально.

## Яндекс.Облако
Для поддержки до 1000 активных пользователей минимальная конфигурация в Яндекс.Облаке обойдётся примерно в 35000 рублей в месяц.
В эту сумму входят 2–3 виртуальные машины под Kubernetes-кластер, управляемая PostgreSQL с репликой, Redis, Kafka, объектное хранилище S3 для снимков и медиа, а также базовое использование CDN.
Такой набор покрывает все ключевые сервисы и обеспечивает горизонтальное масштабирование при росте нагрузки.
